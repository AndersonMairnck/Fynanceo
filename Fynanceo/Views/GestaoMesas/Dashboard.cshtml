@model Fynanceo.ViewModel.PedidosModel.DashboardMesasViewModel

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 text-warning">
            <i class="fas fa-tachometer-alt me-2"></i>Dashboard de Mesas
        </h1>
        <div class="btn-group">
            <a href="@Url.Action("Index", "Mesas")" class="btn btn-outline-warning">
                <i class="fas fa-cog me-2"></i>Gerenciar Mesas
            </a>
           @* <a href="@Url.Action("Create", "Pedidos")" class="btn btn-warning"> *@
            @*     <i class="fas fa-plus me-2"></i>Novo Pedido *@
            @* </a> *@
        </div>
    </div>

    <!-- Cards de Estatísticas -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Mesas Livres
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.MesasLivres</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-chair fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-danger shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                Mesas Ocupadas
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.MesasOcupadas</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-utensils fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Pedidos Cozinha
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.PedidosCozinha</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-utensil-spoon fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid de Mesas -->
    <div class="row">
        @foreach (var mesa in Model.Mesas)
        {
            <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-4">
                <div class="card h-100 shadow-sm border-@(mesa.Status == "Livre" ? "success" : mesa.Status == "Ocupada" ? "danger" : "warning") mesa-card"
                     data-mesa-id="@mesa.Id"
                     data-mesa-status="@mesa.Status">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <i class="fas fa-chair fa-3x text-@(mesa.Status == "Livre" ? "success" : mesa.Status == "Ocupada" ? "danger" : "warning")"></i>
                        </div>
                        <h5 class="card-title">Mesa @mesa.Numero</h5>
                        <p class="card-text">
                            <span class="badge bg-@(mesa.Status == "Livre" ? "success" : mesa.Status == "Ocupada" ? "danger" : "warning")">
                                @mesa.Status
                            </span>
                        </p>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="fas fa-users me-1"></i>@mesa.Capacidade pessoas
                            </small>
                        </p>

                        @if (mesa.Status == "Ocupada")
                        {
                            var pedidoMesa = Model.PedidosAtivos.FirstOrDefault(p => p.MesaId == mesa.Id);
                            if (pedidoMesa != null)
                            {
                                <div class="mt-2">
                                    <small class="text-info">
                                        <i class="fas fa-clock me-1"></i>
                                        @pedidoMesa.Status
                                    </small>
                                </div>
                            }
                        }
                    </div>
                    <div class="card-footer bg-transparent">
                        @if (mesa.Status == "Livre")
                        {
                            <button class="btn btn-success btn-sm w-100 abrir-comanda" data-mesa-id="@mesa.Id">
                                <i class="fas fa-plus me-1"></i>Abrir Comanda
                            </button>
                        }
                        else
                        {
                            <a href="@Url.Action("GerenciarMesa", new { id = mesa.Id })"
                               class="btn btn-primary btn-sm w-100">
                                <i class="fas fa-edit me-1"></i>Gerenciar
                            </a>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Abrir comanda
            $('.abrir-comanda').click(function() {
                var mesaId = $(this).data('mesa-id');

                $.post('@Url.Action("AbrirComanda")', { mesaId: mesaId })
                    .done(function(response) {
                        if (response.success) {
                            window.location.href = '@Url.Action("GerenciarMesa")/' + mesaId;
                        } else {
                            alert('Erro: ' + response.message);
                        }
                    })
                    .fail(function() {
                        alert('Erro ao abrir comanda');
                    });
            });
        });
    </script>
}