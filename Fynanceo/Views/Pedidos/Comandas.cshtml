@model NovaComandaViewModel
@using Fynanceo.Models.Enums
@using Fynanceo.ViewModel
@using Fynanceo.ViewModel.PedidosModel


@{
    ViewData["Title"] = "Nova Comanda";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-plus-circle me-2"></i>Nova Comanda
        </h1>
        <a href="@Url.Action("Index")" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Dados da Comanda</h6>
                </div>
                <div class="card-body">
                    <form asp-action="CriarComanda" method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="TipoPedido" class="control-label"></label>
                                    <select asp-for="TipoPedido" class="form-control" id="tipoPedido">
                                        <option value="">Selecione o tipo</option>
                                        <option value="@TipoPedido.Mesa">Mesa</option>
                                        <option value="@TipoPedido.Balcao">Balcão/Retirada</option>
                                        <option value="@TipoPedido.Delivery">Delivery</option>
                                    </select>
                                    <span asp-validation-for="TipoPedido" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="FuncionarioId" class="control-label"></label>
                                    <select asp-for="FuncionarioId" class="form-control" asp-items="@(new SelectList(Model.Funcionarios, "Id", "Nome"))">
                                        <option value="">Selecione o garçom</option>
                                    </select>
                                    <span asp-validation-for="FuncionarioId" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group" id="mesaGroup">
                                    <label asp-for="MesaId" class="control-label"></label>
                                    <select asp-for="MesaId" class="form-control" asp-items="@(new SelectList(Model.Mesas, "Id", "Numero"))">
                                        <option value="">Selecione a mesa</option>
                                    </select>
                                    <span asp-validation-for="MesaId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group" id="clienteGroup">
                                    <label asp-for="ClienteId" class="control-label"></label>
                                    <select asp-for="ClienteId" class="form-control" asp-items="@(new SelectList(Model.Clientes, "Id", "Nome"))">
                                        <option value="">Selecione o cliente</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group" id="taxaEntregaGroup" style="display: none;">
                                    <label asp-for="TaxaEntrega" class="control-label"></label>
                                    <input asp-for="TaxaEntrega" class="form-control" type="number" step="0.01" min="0" />
                                    <span asp-validation-for="TaxaEntrega" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label asp-for="Observacoes" class="control-label"></label>
                            <textarea asp-for="Observacoes" class="form-control" rows="3"></textarea>
                            <span asp-validation-for="Observacoes" class="text-danger"></span>
                        </div>

                        <div class="form-group mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-check me-2"></i>Criar Comanda
                            </button>
                            <a href="@Url.Action("Index")" class="btn btn-secondary">Cancelar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Informações</h6>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <i class="fas fa-info-circle fa-2x text-primary mb-3"></i>
                        <h5>Tipos de Pedido</h5>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <strong>Mesa:</strong> Consumo no local, vinculado a uma mesa específica.
                    </div>
                    <div class="mb-3">
                        <strong>Balcão/Retirada:</strong> Cliente retira no estabelecimento.
                    </div>
                    <div class="mb-3">
                        <strong>Delivery:</strong> Entrega no endereço do cliente.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Controle de exibição dos campos baseado no tipo de pedido
            $('#tipoPedido').change(function() {
                var tipo = $(this).val();

                // Mesa: mostra mesa, oculta cliente e taxa
                if (tipo === '@TipoPedido.Mesa') {
                    $('#mesaGroup').show();
                    $('#clienteGroup').hide();
                    $('#taxaEntregaGroup').hide();
                    $('#MesaId').prop('required', true);
                    $('#ClienteId').prop('required', false);
                }
                // Balcão: oculta mesa, mostra cliente, oculta taxa
                else if (tipo === '@TipoPedido.Balcao') {
                    $('#mesaGroup').hide();
                    $('#clienteGroup').show();
                    $('#taxaEntregaGroup').hide();
                    $('#MesaId').prop('required', false);
                    $('#ClienteId').prop('required', false);
                }
                // Delivery: oculta mesa, mostra cliente e taxa
                else if (tipo === '@TipoPedido.Delivery') {
                    $('#mesaGroup').hide();
                    $('#clienteGroup').show();
                    $('#taxaEntregaGroup').show();
                    $('#MesaId').prop('required', false);
                    $('#ClienteId').prop('required', true);
                }
                // Default: oculta tudo
                else {
                    $('#mesaGroup').hide();
                    $('#clienteGroup').hide();
                    $('#taxaEntregaGroup').hide();
                }
            });

            // Trigger change on load
            $('#tipoPedido').trigger('change');
        });
    </script>
}